---
layout: default
title: Falling Comet Lab
---

<header style="display: flex; justify-content: space-between; align-items: center; padding: 12px 24px; background: #fff; border-bottom: 1px solid #ddd; box-shadow: 0 2px 6px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100;">
  <h1 style="margin: 0; font-size: 1.8rem; font-weight: bold;">ğŸŒ  Falling Comet Lab</h1>
  <nav style="display: flex; gap: 1.2rem;">
    <a href="/categories/Arduino/" style="text-decoration: none; color: #2a2a2a;">Arduino</a>
    <a href="/categories/Math/" style="text-decoration: none; color: #2a2a2a;">Math</a>
    <a href="/categories/Electronics/" style="text-decoration: none; color: #2a2a2a;">Electronics</a>
    <a href="/about/" style="text-decoration: none; color: #2a2a2a;">é—œæ–¼æˆ‘</a>
  </nav>
</header>

<div class="content-container" style="max-width: 900px; margin: 40px auto; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.08);">

  <h2>ğŸ” æœå°‹æ–‡ç« </h2>
  <input id="search-input" type="text" placeholder="è¼¸å…¥é—œéµå­—æœå°‹æ–‡ç« " style="width:100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc;">
  <ul id="search-results" style="margin-top: 1em; padding-left: 1.2em;"></ul>

  <h2>ğŸ”§ æœ€æ–°æ–‡ç« </h2>
  <ul>
    {% for post in site.posts limit:5 %}
      <li><a href="{{ post.url | relative_url }}" style="color: #4a90e2;">{{ post.title }}</a> <small>({{ post.date | date: "%Y-%m-%d" }})</small></li>
    {% endfor %}
  </ul>

  <h2>ğŸ”¥ ç†±é–€æ–‡ç« æ’è¡Œ</h2>
  <ul id="popular-posts"><li>è¼‰å…¥ä¸­...</li></ul>

  <h2>ğŸ“Œ æ¨™ç±¤é›²</h2>
  {% assign max_size = 0 %}
  {% for tag in site.tags %}
    {% if tag[1].size > max_size %}
      {% assign max_size = tag[1].size %}
    {% endif %}
  {% endfor %}
  {% for tag in site.tags %}
    {% assign size = tag[1].size | times: 1.0 %}
    {% assign font_size = size | divided_by: max_size | times: 120 | plus: 80 %}
    <a href="{{ '/tags/' | append: tag[0] | relative_url }}" style="font-size: {{ font_size | round }}%; margin-right: 0.7rem; color: #4a90e2;">{{ tag[0] }}</a>
  {% endfor %}

  <div id="view-counter" style="margin-top: 20px;"></div>
</div>

<script>
// æœå°‹åŠŸèƒ½
const posts = [
  {% for post in site.posts %}
    { title: "{{ post.title | escape }}", url: "{{ post.url | relative_url }}", content: "{{ post.content | strip_html | strip_newlines | escape }}" },
  {% endfor %}
];
const input = document.getElementById("search-input"), results = document.getElementById("search-results");
input.addEventListener("input", () => {
  const q = input.value.toLowerCase();
  results.innerHTML = "";
  if (q.length < 2) return;
  const filtered = posts.filter(p => p.title.toLowerCase().includes(q) || p.content.toLowerCase().includes(q));
  results.innerHTML = filtered.length ? filtered.map(p => `<li><a href="${p.url}" style="color:#2a2a2a;">${p.title}</a></li>`).join('') : "<li>æ‰¾ä¸åˆ°ç¬¦åˆçš„æ–‡ç« </li>";
});
</script>

<script type="module">
// Firebase ç€è¦½æ¬¡æ•¸ + ç†±é–€æ–‡ç« 
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, query, orderBy, limit, getDocs, doc, updateDoc, increment, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "ä½ çš„ API KEY",
  authDomain: "ä½ çš„ DOMAIN",
  projectId: "ä½ çš„ PROJECT ID",
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function loadPopular() {
  const el = document.getElementById("popular-posts");
  const q = query(collection(db, "posts"), orderBy("views", "desc"), limit(5));
  const snap = await getDocs(q);
  el.innerHTML = snap.empty ? "<li>é‚„æ²’æœ‰ç†±é–€æ–‡ç« å–”ï¼</li>" : "";
  snap.forEach(docSnap => {
    const d = docSnap.data(), id = docSnap.id.replace(/_/g,"/");
    el.innerHTML += `<li><a href="${id}" style="color:#4a90e2;">${d.title || id}ï¼ˆç€è¦½:${d.views || 0}ï¼‰</a></li>`;
  });
}
async function countView() {
  const page = location.pathname.replace(/\//g,"_") || "index";
  const ref = doc(db, "posts", page);
  try { await updateDoc(ref, { views: increment(1) }); } catch { await setDoc(ref, { views: 1 }); }
  const snap = await getDoc(ref);
  if (snap.exists()) document.getElementById("view-counter").innerText = `ğŸ‘ï¸ æœ¬é ç€è¦½æ¬¡æ•¸ï¼š${snap.data().views}`;
}
loadPopular(); countView();
</script>
