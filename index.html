---
layout: default
title: Falling Comet Lab
---

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Falling Comet Lab</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fdfdfd;
      color: #2a2a2a;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      background: #fff;
      border-bottom: 1px solid #ddd;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    header .title {
      font-size: 1.8rem;
      font-weight: bold;
    }
    header nav a {
      margin-left: 16px;
      color: #2a2a2a;
      text-decoration: none;
    }
    header nav a:hover {
      text-decoration: underline;
      color: #4a90e2;
    }
    .container {
      max-width: 960px;
      margin: 40px auto;
      padding: 0 24px;
    }
    #search-input {
      width: 100%;
      padding: 8px 12px;
      margin-bottom: 24px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .section-title {
      font-size: 1.3rem;
      margin: 24px 0 12px;
      font-weight: bold;
    }
    a.post-link {
      color: #4a90e2;
      text-decoration: none;
      font-weight: 600;
    }
    a.post-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<header>
  <div class="title">ğŸŒ  Falling Comet Lab</div>
  <nav>
    <a href="/arduino/">Arduino</a>
    <a href="/math/">Math</a>
    <a href="/electronics/">Electronics</a>
    <a href="/about/">é—œæ–¼æˆ‘</a>
  </nav>
</header>

<div class="container">
  <input id="search-input" type="text" placeholder="ğŸ” æœå°‹æ–‡ç« ">

  <ul id="search-results" style="list-style: none; padding-left: 0;"></ul>

  <div>
    <div class="section-title">ğŸ“Œ æœ€æ–°æ–‡ç« </div>
    <ul>
      {% for post in site.posts limit:5 %}
        <li>
          <a class="post-link" href="{{ post.url }}">{{ post.title }}</a>
          <small>({{ post.date | date: "%Y-%m-%d" }})</small>
        </li>
      {% endfor %}
    </ul>
  </div>

  <div>
    <div class="section-title">ğŸ”¥ ç†±é–€æ–‡ç« </div>
    <ul id="popular-posts"><li>è¼‰å…¥ä¸­...</li></ul>
  </div>

  <div>
    <div class="section-title">ğŸ·ï¸ æ¨™ç±¤é›²</div>
    {% assign max_size = 0 %}
    {% for tag in site.tags %}
      {% if tag[1].size > max_size %}
        {% assign max_size = tag[1].size %}
      {% endif %}
    {% endfor %}
    {% for tag in site.tags %}
      {% assign size = tag[1].size | times: 1.0 %}
      {% assign font_size = size | divided_by: max_size | times: 120 | plus: 80 %}
      <a href="/tags/{{ tag[0] }}" style="font-size: {{ font_size | round }}%; margin-right: 8px; text-decoration: none; color: #4a90e2;">{{ tag[0] }}</a>
    {% endfor %}
  </div>

  <div id="view-counter" style="margin-top: 32px;"></div>
</div>

<script>
// æœå°‹åŠŸèƒ½
const posts = [
  {% for post in site.posts %}
  { title: "{{ post.title | escape }}", url: "{{ post.url }}", content: "{{ post.content | strip_html | strip_newlines | escape }}" },
  {% endfor %}
];
const searchInput = document.getElementById("search-input");
const searchResults = document.getElementById("search-results");

searchInput.addEventListener("input", () => {
  const q = searchInput.value.toLowerCase();
  searchResults.innerHTML = "";
  if (q.length < 2) return;
  const filtered = posts.filter(p => p.title.toLowerCase().includes(q) || p.content.toLowerCase().includes(q));
  if (filtered.length === 0) {
    searchResults.innerHTML = "<li>æ‰¾ä¸åˆ°ç¬¦åˆçš„æ–‡ç« </li>";
    return;
  }
  filtered.forEach(p => {
    const li = document.createElement("li");
    li.innerHTML = `<a href="${p.url}" class="post-link">${p.title}</a>`;
    searchResults.appendChild(li);
  });
});
</script>

<script type="module">
// Firebase ç†±é–€æ–‡ç« èˆ‡ç€è¦½æ¬¡æ•¸
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, query, orderBy, limit, getDocs, doc, updateDoc, increment, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "...",
  authDomain: "...",
  projectId: "...",
});
const db = getFirestore(app);

async function loadPopularPosts() {
  const q = query(collection(db, "posts"), orderBy("views", "desc"), limit(5));
  const querySnapshot = await getDocs(q);
  const popularPosts = document.getElementById("popular-posts");
  popularPosts.innerHTML = "";
  querySnapshot.forEach(docSnap => {
    const d = docSnap.data();
    const id = docSnap.id.replace(/_/g, "/");
    const li = document.createElement("li");
    li.innerHTML = `<a class="post-link" href="${id}">${d.title || id}ï¼ˆ${d.views || 0} æ¬¡ç€è¦½ï¼‰</a>`;
    popularPosts.appendChild(li);
  });
}

async function countView() {
  const path = location.pathname.replace(/\//g, "_") || "index";
  const ref = doc(db, "posts", path);
  try { await updateDoc(ref, { views: increment(1) }); } catch { await setDoc(ref, { views: 1 }); }
  const snap = await getDoc(ref);
  if (snap.exists()) {
    document.getElementById("view-counter").innerHTML = `ğŸ‘ï¸ æœ¬é ç€è¦½æ¬¡æ•¸ï¼š${snap.data().views}`;
  }
}

loadPopularPosts();
countView();
</script>

</body>
</html>
