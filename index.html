<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Falling Comet Lab</title>
  <style>
    body {
      margin: 0;
      background-image: url('https://rubychenglab.github.io/images/20efc85c275d9dcb694f84c6dd2d5378_t.jpeg');
      background-size: cover;
      background-position: center center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #2a2a2a;
    }
    .content-container {
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 12px;
      padding: 40px;
      margin: 80px auto 0 auto;
      max-width: 960px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }
    footer {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      text-align: center;
      font-size: 0.9rem;
      color: #555;
      margin-top: 40px;
      border-top: 1px solid #ddd;
    }
    footer a {
      color: #4a90e2;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<header style="position: fixed; top: 0; left: 0; right: 0; background: #fff; border-bottom: 1px solid #ddd; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 12px 24px; display: flex; justify-content: space-between; z-index: 100;">
  <h1 style="margin: 0; font-size: 1.8rem;">ğŸŒ  Falling Comet Lab</h1>
  <nav>
    <a href="/categories/Arduino/" style="margin-right: 1rem;">Arduino</a>
    <a href="/categories/Math/" style="margin-right: 1rem;">Math</a>
    <a href="/categories/Electronics/" style="margin-right: 1rem;">Electronics</a>
    <a href="/about/">é—œæ–¼æˆ‘</a>
  </nav>
</header>

<div class="content-container">

  <h2>ğŸ” æœå°‹æ–‡ç« </h2>
  <input type="text" id="search-input" placeholder="è¼¸å…¥é—œéµå­—æœå°‹æ–‡ç« " style="width: 100%; padding: 10px; font-size: 1rem; border-radius: 6px; border: 1.5px solid #ccc;">
  <ul id="search-results" style="list-style: none; padding-left: 0; margin-top: 10px;"></ul>

  <h2>ğŸ”¥ ç†±é–€æ–‡ç« æ’è¡Œ</h2>
  <ul id="popular-posts"><li>è¼‰å…¥ä¸­...</li></ul>

  <h2>ğŸ”§ æœ€æ–°æ–‡ç« </h2>
  <ul>
    <!-- é€™è£¡å¯ç”± Jekyll ç”Ÿæˆæœ€æ–°æ–‡ç«  -->
    <li><a href="#" style="color: #4a90e2;">ç¯„ä¾‹æ–‡ç« ä¸€</a></li>
    <li><a href="#" style="color: #4a90e2;">ç¯„ä¾‹æ–‡ç« äºŒ</a></li>
  </ul>

  <h2>ğŸ¯ æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ</h2>
  <ul>
    <li>ğŸ’¡ æä¾› Arduino å°ˆæ¡ˆæ•™å­¸èˆ‡å‰µä½œéˆæ„Ÿ</li>
    <li>ğŸ“˜ ä¸‰é›»ä¸€å·¥ç­†è¨˜æ•´ç†</li>
    <li>ğŸ” æ•´åˆäº’å‹•å­¸ç¿’å·¥å…·</li>
    <li>ğŸ§ å¶çˆ¾åˆ†äº«ç”œé»èˆ‡å‰µæ„äººç”Ÿ</li>
  </ul>

  <p id="view-counter" style="margin-top: 20px;">ğŸ‘ï¸ æœ¬é ç€è¦½æ¬¡æ•¸ï¼šè¼‰å…¥ä¸­...</p>

</div>

<footer>
  &copy; 2025 Falling Comet Lab | <a href="/about/">é—œæ–¼æœ¬ç«™</a> | Powered by Jekyll + Firebase
</footer>

<script type="module">
  // Firebase è¨­å®š
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, query, orderBy, limit, getDocs, doc, getDoc, updateDoc, increment, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBmR7K4ECZA0Vv0PlHn6dMxg5P06UsBnq0",
    authDomain: "falling-comet-lab-blog.firebaseapp.com",
    projectId: "falling-comet-lab-blog",
    storageBucket: "falling-comet-lab-blog.appspot.com",
    messagingSenderId: "275403715950",
    appId: "1:275403715950:web:25383ec082d6ff3338bd7f",
    measurementId: "G-TRDSPMNYQK"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ç€è¦½æ¬¡æ•¸çµ±è¨ˆ
  async function countView() {
    const pagePath = location.pathname.replace(/\//g, "_") || "index";
    const postRef = doc(db, "posts", pagePath);
    try {
      await updateDoc(postRef, { views: increment(1) });
    } catch {
      await setDoc(postRef, { views: 1 });
    }
    const postSnap = await getDoc(postRef);
    if (postSnap.exists()) {
      document.getElementById("view-counter").innerHTML = `ğŸ‘ï¸ æœ¬é ç€è¦½æ¬¡æ•¸ï¼š${postSnap.data().views}`;
    }
  }
  countView();

  // ç†±é–€æ–‡ç« è®€å–
  async function loadPopularPosts() {
    const q = query(collection(db, "posts"), orderBy("views", "desc"), limit(5));
    const snapshot = await getDocs(q);
    const el = document.getElementById("popular-posts");
    el.innerHTML = "";
    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const id = docSnap.id.replace(/_/g, "/");
      const li = document.createElement("li");
      li.innerHTML = `<a href="${id}" style="color: #4a90e2;">${data.title || id}</a>ï¼ˆç€è¦½: ${data.views}ï¼‰`;
      el.appendChild(li);
    });
    if (snapshot.empty) el.innerHTML = "<li>é‚„æ²’æœ‰ç†±é–€æ–‡ç« å–”ï¼</li>";
  }
  loadPopularPosts();

  // æœå°‹åŠŸèƒ½ (ç¯„ä¾‹ç”¨éœæ…‹è³‡æ–™ï¼Œå¯é…åˆ Jekyll è‡ªå‹•ç”Ÿæˆ posts é™£åˆ—)
  const posts = [
    { title: "ç¯„ä¾‹æ–‡ç« ä¸€", url: "#", content: "å…§å®¹ä¸€..." },
    { title: "ç¯„ä¾‹æ–‡ç« äºŒ", url: "#", content: "å…§å®¹äºŒ..." }
  ];
  document.getElementById("search-input").addEventListener("input", function() {
    const q = this.value.toLowerCase();
    const resultEl = document.getElementById("search-results");
    resultEl.innerHTML = "";
    if (q.length < 2) return;
    const results = posts.filter(p => p.title.toLowerCase().includes(q) || p.content.toLowerCase().includes(q));
    if (results.length === 0) {
      resultEl.innerHTML = "<li>æ‰¾ä¸åˆ°ç¬¦åˆçš„æ–‡ç« </li>";
    } else {
      results.forEach(p => {
        const li = document.createElement("li");
        li.innerHTML = `<a href="${p.url}" style="color:#2a2a2a;">${p.title}</a>`;
        resultEl.appendChild(li);
      });
    }
  });
</script>

</body>
</html>
