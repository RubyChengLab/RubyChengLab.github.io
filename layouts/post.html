<style>
  body {
    background-image: url('https://rubychenglab.github.io/images/20efc85c275d9dcb694f84c6dd2d5378_t.jpeg');
    background-size: cover;
    background-position: center center;
    background-attachment: fixed;
    background-repeat: no-repeat;
    margin: 0; /* é¿å… body é è¨­ margin å½±éŸ¿è¦–è¦º */
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
  }

  /* åŠé€æ˜å…§å®¹å€ */
  .content-wrapper {
    max-width: 800px;
    margin: 3rem auto;
    background-color: rgba(255, 255, 255, 0.85);
    border-radius: 12px;
    padding: 40px 30px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  }

  /* æ–‡ç« æ¨™é¡Œ */
  .post-title {
    margin-top: 0;
    font-weight: 700;
    font-size: 2.5rem;
    line-height: 1.2;
  }

  /* æ—¥æœŸæ¨£å¼ */
  .post-date {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 1.8rem;
  }

  /* æ¨™ç±¤é€£çµ */
  .post-tags a {
    color: #1a73e8;
    text-decoration: none;
    margin-right: 0.6rem;
  }

  .post-tags a:hover {
    text-decoration: underline;
  }

  /* ç€è¦½æ¬¡æ•¸æ–‡å­— */
  #view-count {
    color: #555;
    font-size: 0.95rem;
    margin-top: 2rem;
  }
</style>

<article class="post">
  <div class="content-wrapper">
    <h1 class="post-title">{{ page.title }}</h1>
    <p class="post-date">{{ page.date | date: "%Y-%m-%d" }}</p>
    {{ content }}

    {% if page.tags %}
      <p class="post-tags">ğŸ·ï¸ Tags: 
        {% for tag in page.tags %}
          <a href="{{ site.baseurl }}/tags/{{ tag | slugify }}/">{{ tag }}</a>{% unless forloop.last %}, {% endunless %}
        {% endfor %}
      </p>
    {% endif %}

    <p id="view-count">ğŸ‘ï¸ æœ¬æ–‡ç€è¦½æ¬¡æ•¸ï¼šè¼‰å…¥ä¸­...</p>
  </div>
</article>

<!-- Firebase CDN å…¼å®¹ç‰ˆæœ¬ -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  // Firebase é…ç½®ï¼Œè«‹å‹¿éš¨æ„æ´©æ¼çµ¦ä¸ä¿¡ä»»çš„äºº
  const firebaseConfig = {
    apiKey: "AIzaSyBmR7K4ECZA0Vv0PlHn6dMxg5P06UsBnq0",
    authDomain: "falling-comet-lab-blog.firebaseapp.com",
    projectId: "falling-comet-lab-blog",
    storageBucket: "falling-comet-lab-blog.appspot.com",
    messagingSenderId: "275403715950",
    appId: "1:275403715950:web:25383ec082d6ff3338bd7f"
  };

  // é¿å…é‡è¤‡åˆå§‹åŒ– Firebase
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
    console.log("Firebase åˆå§‹åŒ–æˆåŠŸ");
  } else {
    console.log("Firebase å·²åˆå§‹åŒ–");
  }

  const db = firebase.firestore();

  // ä½¿ç”¨ç•¶å‰é é¢è·¯å¾‘ä½œç‚º Firestore æ–‡ä»¶ ID
  const pagePath = location.pathname.replace(/^\/|\/$/g, "") || "index";
  console.log("ä½¿ç”¨çš„æ–‡ä»¶ ID (pagePath):", pagePath);

  const ref = db.collection("posts").doc(pagePath);

  // æ›´æ–°ç€è¦½æ¬¡æ•¸ä¸¦å–å¾—æœ€æ–°æ•¸å€¼
  ref.get()
    .then(docSnap => {
      if (docSnap.exists) {
        console.log("æ–‡ä»¶å­˜åœ¨ï¼Œç€è¦½æ¬¡æ•¸ç‚º:", docSnap.data().views);
        return ref.update({ views: firebase.firestore.FieldValue.increment(1) });
      } else {
        console.log("æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå»ºç«‹æ–°æ–‡ä»¶ï¼Œåˆå§‹ç€è¦½æ•¸ 1");
        return ref.set({ views: 1 });
      }
    })
    .then(() => ref.get())
    .then(updatedDoc => {
      const count = updatedDoc.data().views || 1;
      console.log("æ›´æ–°å¾Œçš„ç€è¦½æ¬¡æ•¸:", count);
      document.getElementById("view-count").innerText = `ğŸ‘ï¸ æœ¬æ–‡ç€è¦½æ¬¡æ•¸ï¼š${count}`;
    })
    .catch(error => {
      console.error("è®€å¯« Firestore ç™¼ç”ŸéŒ¯èª¤:", error);
      document.getElementById("view-count").innerText = "ğŸ‘ï¸ æœ¬æ–‡ç€è¦½æ¬¡æ•¸ï¼šéŒ¯èª¤";
    });
</script>
